# https是如何保证安全的

## 安全特性

1. http的问题:
- 明文传输
- 不验证通信方的身份

2. https = http + SSL/TSL

## 如何做的

主要通过以下手段:
- 非对称加密：实现身份认证和密钥协商
- 对称加密：采用协商的密钥对数据加密
- 摘要算法：验证信息的完整性
- 数字签名：身份验证
- CA证书：验证证书的合法性

### 非对称加密
- 公钥加密，私钥解密
- 私钥加密，公钥解密
- 可以想象成虎符，只有凑齐才能看到内容
- 一般把公钥公开，私钥自己保留

### 对称加密
- 加密和解密使用相同的密钥

### 摘要算法
- 可以理解成一种哈希函数实现的压缩算法
- 数据 -> 独一无二字符串

### 数字签名
- 私钥加密，公钥解密
- 私钥加密的签名公开，大家可以用公钥来验证身份

### CA证书
数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场

- 服务器的运营人员向数字证书认证机构提出公开密钥的申请
- 数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名（用机构的私钥签名）
- 然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书后绑定在一起
- 服务器会将这份由数字证书认证机构颁发的数字证书发送给客户端，以进行非对称加密方式通信

接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，则证明：

- 认证服务器的公开密钥的是真实有效的数字证书认证机构
- 服务器的公开密钥是值得信赖的


## 过程

- 客户端
1. 用 **证书机构公钥** 验证**服务器证书签名**，通过则证明机构给的服务器公钥是可信的。
2. 生成**会话密钥**，用服务器公钥加密，发给服务器。

- 服务器
3. 用自己**私钥**解密得到**会话密钥**。

- 客户端
4. 通过**会话密钥**加密明文，传给服务器。
5. 通过SHA-2等哈希算法生成**摘要**，用自己的私钥生成**签名**。
6. 将摘要和签名一起发给服务器。

- 服务器
7. 用**会话密钥**解密得到明文。
8. 用**客户端公钥**验证签名。
9. 用SHA-2等哈希算法和摘要验证明文的**完整性**。
